<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-learn/resilience/retry-and-repeat" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Retry and repeat | Arrow</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://arrow-kt.io/img/social-card.jpg /><meta data-rh=true name=twitter:image content=https://arrow-kt.io/img/social-card.jpg /><meta data-rh=true property=og:url content=https://arrow-kt.io/learn/resilience/retry-and-repeat/ /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Retry and repeat | Arrow"/><meta data-rh=true name=description content="Retry and repeat computations using Schedule"/><meta data-rh=true property=og:description content="Retry and repeat computations using Schedule"/><link data-rh=true rel=icon href=/img/arrow-brand-icon.svg /><link data-rh=true rel=canonical href=https://arrow-kt.io/learn/resilience/retry-and-repeat/ /><link data-rh=true rel=alternate href=https://arrow-kt.io/learn/resilience/retry-and-repeat/ hreflang=en /><link data-rh=true rel=alternate href=https://arrow-kt.io/learn/resilience/retry-and-repeat/ hreflang=x-default /><link rel=alternate type=application/rss+xml href=/community/blog/rss.xml title="Arrow RSS Feed"><link rel=alternate type=application/atom+xml href=/community/blog/atom.xml title="Arrow Atom Feed"><link rel=stylesheet href=/assets/css/styles.8bb0fd9c.css /><script src=/assets/js/runtime~main.dbc143ef.js defer></script><script src=/assets/js/main.63b3d8dc.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/arrow-brand.svg alt="Arrow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/arrow-brand-dark.svg alt="Arrow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/>Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/learn/overview/>Learn</a><ul class=dropdown__menu><li><a class=dropdown__link href=/learn/quickstart/>Quickstart</a><li><a class=dropdown__link href=/learn/typed-errors/>Typed errors</a><li><a class=dropdown__link href=/learn/coroutines/>Concurrency and resources</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/learn/resilience/>Resilience</a><li><a class=dropdown__link href=/learn/immutable-data/>Immutable data</a><li><a class=dropdown__link href=/learn/collections-functions/>Collections and functions</a><li><a class=dropdown__link href=/learn/design/>Design recipes</a><li><a class=dropdown__link href=/learn/projects/>Example projects</a><li><a class=dropdown__link href=/learn/integrations/>Integrations</a></ul></div><a href=https://apidocs.arrow-kt.io target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">API Docs<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Community</a><ul class=dropdown__menu><li><a class=dropdown__link href=/community/blog/>Blog</a><li><a class=dropdown__link href=/libraries/>More libraries</a></ul></div><div class=navbar__item><img src="https://img.shields.io/maven-central/v/io.arrow-kt/arrow-core?color=5b88f8&label=latest"></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=Search aria-label=Search class="navbar__search-input searchInput_YFbd" value="" /><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/quickstart/><span title=Quickstart class=categoryLinkLabel_W154>Quickstart</span></a><button aria-label="Expand sidebar category 'Quickstart'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/typed-errors/><span title="Typed errors" class=categoryLinkLabel_W154>Typed errors</span></a><button aria-label="Expand sidebar category 'Typed errors'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/coroutines/><span title="Concurrency and resources" class=categoryLinkLabel_W154>Concurrency and resources</span></a><button aria-label="Expand sidebar category 'Concurrency and resources'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/learn/resilience/><span title=Resilience class=categoryLinkLabel_W154>Resilience</span></a><button aria-label="Collapse sidebar category 'Resilience'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/learn/resilience/retry-and-repeat/><span title="Retry and repeat" class=linkLabel_WmDU>Retry and repeat</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/learn/resilience/circuitbreaker/><span title="Circuit breaker" class=linkLabel_WmDU>Circuit breaker</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/learn/resilience/saga/><span title=Saga class=linkLabel_WmDU>Saga</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/immutable-data/><span title="Immutable data" class=categoryLinkLabel_W154>Immutable data</span></a><button aria-label="Expand sidebar category 'Immutable data'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/collections-functions/><span title="Collections and functions" class=categoryLinkLabel_W154>Collections and functions</span></a><button aria-label="Expand sidebar category 'Collections and functions'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/design/><span title="Design recipes" class=categoryLinkLabel_W154>Design recipes</span></a><button aria-label="Expand sidebar category 'Design recipes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/learn/projects/><span title="Example projects" class=linkLabel_WmDU>Example projects</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/learn/integrations/><span title=Integrations class=linkLabel_WmDU>Integrations</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/learn/summary/><span title=Summary class=linkLabel_WmDU>Summary</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-hidden"><a class=menu__link href=/learn/overview/><span title=overview class=linkLabel_WmDU>overview</span></a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Retry and repeat</h1></header>
<p>A common demand when working with actions is to retry or repeat them when
(adverse) certain circumstances happen. Usually, the retrial or repetition does
not occur immediately; instead, it is done based on a policy. For instance, when
fetching content from a network request, we may want to retry it when it fails
using an exponential backoff algorithm for a maximum of 15 seconds or 5
attempts, whatever happens first.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11M9 11.5h2v4H9v2h6v-2h-2v-6H9zM13 8V6h-2v2z" clip-rule=evenodd /></svg></span>Additional context for this pattern</div><div class=admonitionContent_BuS1><p><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/retry target=_blank rel="noopener noreferrer" class="">Retry pattern</a>
in <em>Cloud Design Patterns</em>.</div></div>
<p><a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/index.html target=_blank rel="noopener noreferrer" class=""><code>Schedule</code></a>
allows you to define and compose powerful yet simple policies. There are two
steps involved in using <code>Schedule</code>.</p>
<ol>
<li class="">First, we need to <strong>construct</strong> a policy, which specifies the amount and the
delay in repetition.</li>
<li class="">Then we <strong>run</strong> this schedule with a specified action. There are two ways to do so:<!-- -->
<ul>
<li class=""><a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/retry.html target=_blank rel="noopener noreferrer" class=""><code>retry</code></a>
executes the action once, and if it fails, it is reattempted based
on the scheduling policy. It stops when the action succeeds or when the policy
determines it should not be reattempted again.</li>
<li class=""><a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/repeat.html target=_blank rel="noopener noreferrer" class=""><code>repeat</code></a>
executes the action, and if it succeeds, keeps executing it again based on
the scheduling policy passed as an argument. It stops if the action
fails or the policy determines it should not be executed again.
It returns the last internal state of the scheduling policy
or the error that happened running the action.</li>
</ul>
</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M4.25 9a7.75 7.75 0 1 1 15.5 0v4.823l2.464 4.927H1.787l2.463-4.927zM10 23h4v-2h-4z" clip-rule=evenodd /></svg></span>Retrying only on certain exceptions</div><div class=admonitionContent_BuS1><p>Since version 2.0, you can specify a subclass of <code>Throwable</code> as the first type argument
to <code>retry</code> to focus only on those exceptions. It is customary to leave the second type
argument unspecified.<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token plain">policy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">retry</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">IllegalArgumentException</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> _</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=constructing-a-policy>Constructing a policy<a href=#constructing-a-policy class=hash-link aria-label="Direct link to Constructing a policy" title="Direct link to Constructing a policy" translate=no>​</a></h2>
<p>Scheduling policies are constructed using the methods in <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/-companion/index.html target=_blank rel="noopener noreferrer" class=""><code>Schedule</code>'s
companion object</a>.
Schedule policies also return values on each step, which can be used to
make decisions based on previous values.</p>
<p>One of the simplest policies is recurring ten times. This means that if we
call <code>repeat</code>, the same action is performed ten times, and if we call <code>retry</code>,
the action is attempted until successful for a maximum of ten times.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token function" style=color:#EDB368>recurTenTimes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">recurs</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<p>The exponential backoff algorithm is a standard algorithm to retry operations communicating with external services,
such as network requests. Roughly, this
means that the delay between attempts increases by the given factor.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token annotation builtin" style="color:rgb(86, 156, 214)">@ExperimentalTime</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> exponential </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exponential</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Unit</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>250</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">milliseconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<p>Here's a much more complex schedule. Let's walk through it step by step:</p>
<ul>
<li class="">It recurs with exponential backoff as long as the delay is less than 60 seconds.</li>
<li class="">Afterwards, we have a spaced (constant) delay of 60 seconds for up to 100 attempts.</li>
<li class="">Some random noise is added by calling <code>jittered</code>.</li>
<li class="">We also collect every input to the schedule and return it.</li>
</ul>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token annotation builtin" style="color:rgb(86, 156, 214)">@ExperimentalTime</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token function" style=color:#EDB368>complexPolicy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Schedule</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> List</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exponential</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">milliseconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>doWhile</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> _</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> duration </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"> duration </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">seconds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>andThen</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">spaced</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">seconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">and</span><span class="token plain"> Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>recurs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>jittered</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>zipRight</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">identity</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>collect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=repeating-an-action>Repeating an action<a href=#repeating-an-action class=hash-link aria-label="Direct link to Repeating an action" title="Direct link to Repeating an action" translate=no>​</a></h2>
<p>When we repeat an action, we do it as long as it is successful and the
scheduling policy tells us to keep recursing.
For example, this block repeats an action three times after its first successful
execution (so four times in total).</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>example</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Unit </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>var</span><span class="token plain"> counter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">recurs</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Unit</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>repeat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    counter</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  counter shouldBe </span><span class="token number" style=color:#cfcd9a>4</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>Notice that we did not handle the error case. There are overloads
<a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/repeat-or-else.html target=_blank rel="noopener noreferrer" class=""><code>repeatOrElse</code></a>
and <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/repeat-or-else-either.html target=_blank rel="noopener noreferrer" class=""><code>repeatOrElseEither</code></a>
offering that capability. Repeat will just rethrow any error encountered.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=collecting-values>Collecting values<a href=#collecting-values class=hash-link aria-label="Direct link to Collecting values" title="Direct link to Collecting values" translate=no>​</a></h3>
<p>Using <code>repeat</code>, the resulting value is the number of iterations it has performed.
We're throwing away any value produced by each iteration of the repetition.
But we have three other possibilities:</p>
<ul>
<li class="">Discard all results; that is, return <code>Unit</code>.</li>
<li class="">Discard all intermediate results and just keep the last produced result.</li>
<li class="">Keep all intermediate results.</li>
</ul>
<p>To discard the values provided by the repetition of the action, we combine our
policy with <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/-companion/unit.html target=_blank rel="noopener noreferrer" class=""><code>Schedule.unit</code></a>,
using the <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/zip-left.html target=_blank rel="noopener noreferrer" class=""><code>zipLeft</code></a>
or <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/zip-right.html target=_blank rel="noopener noreferrer" class=""><code>zipRight</code></a>
combinators, which keep just the output of one of the policies:</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>example</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Unit </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>var</span><span class="token plain"> counter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> keepLeft </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">identity</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Unit</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> zipLeft Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>recurs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>repeat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    counter</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> keepRight </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">recurs</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Unit</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> zipRight Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">identity</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Unit</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>repeat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    counter</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  counter shouldBe </span><span class="token number" style=color:#cfcd9a>8</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  keepLeft shouldBe Unit</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  keepRight shouldBe Unit</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>Following the same strategy, we can zip it with the <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/-companion/identity.html target=_blank rel="noopener noreferrer" class=""><code>Schedule.identity</code></a>
policy to keep only the last result of the action.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>example</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Unit </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>var</span><span class="token plain"> counter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> keepLast </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">identity</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">String</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> zipLeft Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>recurs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>repeat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    counter</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token string-literal singleline string" style=color:#5B88F8>"</span><span class="token string-literal singleline interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">$</span><span class="token string-literal singleline interpolation expression" style=color:#b0bee3>counter</span><span class="token string-literal singleline string" style=color:#5B88F8>"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  keepLast shouldBe </span><span class="token string-literal singleline string" style=color:#5B88F8>"4"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>Finally, if we want to keep all intermediate results, we can zip the policy with
<a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/-companion/collect.html target=_blank rel="noopener noreferrer" class=""><code>Schedule.collect</code></a>.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>example</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Unit </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>var</span><span class="token plain"> counter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> keepAll </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">collect</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> zipLeft Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>recurs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>repeat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    counter</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    counter</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  keepAll shouldBe </span><span class="token function" style=color:#EDB368>listOf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=untilwhile-it-produces-a-certain-value>Until/while it produces a certain value<a href=#untilwhile-it-produces-a-certain-value class=hash-link aria-label="Direct link to Until/while it produces a certain value" title="Direct link to Until/while it produces a certain value" translate=no>​</a></h3>
<p>We can make use of the policies <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/-companion/do-while.html target=_blank rel="noopener noreferrer" class=""><code>doWhile</code></a>
and <a href=https://apidocs.arrow-kt.io/arrow-resilience/arrow.resilience/-schedule/-companion/do-until.html target=_blank rel="noopener noreferrer" class=""><code>doUntil</code></a>
to repeat an action while or until its produced result matches a given predicate.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>example</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Unit </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>var</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style=color:#5B88F8>""</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  Schedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">doWhile</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">String</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> _ </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">length </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>5</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>repeat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    result </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> </span><span class="token string-literal singleline string" style=color:#5B88F8>"a"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    result</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  result shouldBe </span><span class="token string-literal singleline string" style=color:#5B88F8>"aaaaaa"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/learn/resilience/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Resilience</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/learn/resilience/circuitbreaker/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Circuit breaker</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#constructing-a-policy class="table-of-contents__link toc-highlight">Constructing a policy</a><li><a href=#repeating-an-action class="table-of-contents__link toc-highlight">Repeating an action</a><ul><li><a href=#collecting-values class="table-of-contents__link toc-highlight">Collecting values</a><li><a href=#untilwhile-it-produces-a-certain-value class="table-of-contents__link toc-highlight">Until/while it produces a certain value</a></ul></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid container_y1z5"><div><div class="margin-bottom--sm logo_cbK_"><a href=https://arrow-kt.io rel="noopener noreferrer" class=footerLogoLink_BH7S><img src=/img/arrow-brand.svg alt="Arrow Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width=128 height=42 /><img src=/img/arrow-brand-dark.svg alt="Arrow Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width=128 height=42 /></a></div><small><div class=footer__copyright>Arrow is developed and maintained by the community</div></small></div><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a href=https://apidocs.arrow-kt.io target=_blank rel="noopener noreferrer" class=footer__link-item>API Docs<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a class=footer__link-item href=/community/blog/>Blog</a><li class=footer__item><a class=footer__link-item href=/learn/projects/>Example projects</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Learn</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/learn/quickstart/>Quickstart</a><li class=footer__item><a class=footer__link-item href=/learn/typed-errors/>Typed errors</a><li class=footer__item><a class=footer__link-item href=/learn/coroutines/>Coroutines</a><li class=footer__item><a class=footer__link-item href=/learn/resilience/>Resilience</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>...</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/learn/immutable-data/>Immutable data</a><li class=footer__item><a class=footer__link-item href=/learn/collections-functions/>Collections and functions</a><li class=footer__item><a class=footer__link-item href=/learn/design/>Design</a><li class=footer__item><a class=footer__link-item href=/learn/integrations/>Integrations</a></ul></div></div><ul class="clean-list container_dM9r"><li><a href=https://twitter.com/arrow_kt target=_blank rel="noopener noreferrer"><img src=/img/icon-social-twitter.svg alt=Twitter title=Twitter height=24px width=24px /></a><li><a href=https://slack-chats.kotlinlang.org/c/arrow target=_blank rel="noopener noreferrer"><img src=/img/icon-social-slack.svg alt=Slack title=Slack height=24px width=24px /></a><li><a href=https://github.com/arrow-kt target=_blank rel="noopener noreferrer"><img src=/img/icon-social-github.svg alt=GitHub title=GitHub height=24px width=24px /></a><li><a href=https://stackoverflow.com/questions/tagged/arrow-kt target=_blank rel="noopener noreferrer"><img src=/img/icon-social-stackoverflow.svg alt="Stack Overflow" title="Stack Overflow" height=24px width=24px /></a></li><div class=starsContainer_WEfU><div>Loading...</div></div></ul></div></footer></div></body>