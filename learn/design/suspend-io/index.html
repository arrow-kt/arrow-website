<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-learn/design/suspend-io" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Why suspend over IO | Arrow</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://arrow-kt.io/img/social-card.jpg /><meta data-rh=true name=twitter:image content=https://arrow-kt.io/img/social-card.jpg /><meta data-rh=true property=og:url content=https://arrow-kt.io/learn/design/suspend-io/ /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Why suspend over IO | Arrow"/><meta data-rh=true name=description content="Other functional ecosystems, Scala and Haskell among others,"/><meta data-rh=true property=og:description content="Other functional ecosystems, Scala and Haskell among others,"/><link data-rh=true rel=icon href=/img/arrow-brand-icon.svg /><link data-rh=true rel=canonical href=https://arrow-kt.io/learn/design/suspend-io/ /><link data-rh=true rel=alternate href=https://arrow-kt.io/learn/design/suspend-io/ hreflang=en /><link data-rh=true rel=alternate href=https://arrow-kt.io/learn/design/suspend-io/ hreflang=x-default /><link rel=alternate type=application/rss+xml href=/community/blog/rss.xml title="Arrow RSS Feed"><link rel=alternate type=application/atom+xml href=/community/blog/atom.xml title="Arrow Atom Feed"><link rel=stylesheet href=/assets/css/styles.8bb0fd9c.css /><script src=/assets/js/runtime~main.9536f532.js defer></script><script src=/assets/js/main.708a032c.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/arrow-brand.svg alt="Arrow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/arrow-brand-dark.svg alt="Arrow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/>Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/learn/overview/>Learn</a><ul class=dropdown__menu><li><a class=dropdown__link href=/learn/quickstart/>Quickstart</a><li><a class=dropdown__link href=/learn/typed-errors/>Typed errors</a><li><a class=dropdown__link href=/learn/coroutines/>Concurrency and resources</a><li><a class=dropdown__link href=/learn/resilience/>Resilience</a><li><a class=dropdown__link href=/learn/immutable-data/>Immutable data</a><li><a class=dropdown__link href=/learn/collections-functions/>Collections and functions</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/learn/design/>Design recipes</a><li><a class=dropdown__link href=/learn/projects/>Example projects</a><li><a class=dropdown__link href=/learn/integrations/>Integrations</a></ul></div><a href=https://apidocs.arrow-kt.io target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">API Docs<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Community</a><ul class=dropdown__menu><li><a class=dropdown__link href=/community/blog/>Blog</a><li><a class=dropdown__link href=/libraries/>More libraries</a></ul></div><div class=navbar__item><img src="https://img.shields.io/maven-central/v/io.arrow-kt/arrow-core?color=5b88f8&label=latest"></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=Search aria-label=Search class="navbar__search-input searchInput_YFbd" value="" /><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/quickstart/><span title=Quickstart class=categoryLinkLabel_W154>Quickstart</span></a><button aria-label="Expand sidebar category 'Quickstart'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/typed-errors/><span title="Typed errors" class=categoryLinkLabel_W154>Typed errors</span></a><button aria-label="Expand sidebar category 'Typed errors'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/coroutines/><span title="Concurrency and resources" class=categoryLinkLabel_W154>Concurrency and resources</span></a><button aria-label="Expand sidebar category 'Concurrency and resources'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/resilience/><span title=Resilience class=categoryLinkLabel_W154>Resilience</span></a><button aria-label="Expand sidebar category 'Resilience'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/immutable-data/><span title="Immutable data" class=categoryLinkLabel_W154>Immutable data</span></a><button aria-label="Expand sidebar category 'Immutable data'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/learn/collections-functions/><span title="Collections and functions" class=categoryLinkLabel_W154>Collections and functions</span></a><button aria-label="Expand sidebar category 'Collections and functions'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/learn/design/><span title="Design recipes" class=categoryLinkLabel_W154>Design recipes</span></a><button aria-label="Collapse sidebar category 'Design recipes'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/learn/design/domain-modeling/><span title="Domain modeling" class=linkLabel_WmDU>Domain modeling</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/learn/design/effects-contexts/><span title="Effects and contexts" class=linkLabel_WmDU>Effects and contexts</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/learn/design/receivers-flatmap/><span title="Receivers vs. flatMap" class=linkLabel_WmDU>Receivers vs. flatMap</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/learn/design/suspend-io/><span title="Why suspend over IO" class=linkLabel_WmDU>Why suspend over IO</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/learn/projects/><span title="Example projects" class=linkLabel_WmDU>Example projects</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/learn/integrations/><span title=Integrations class=linkLabel_WmDU>Integrations</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/learn/summary/><span title=Summary class=linkLabel_WmDU>Summary</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-hidden"><a class=menu__link href=/learn/overview/><span title=overview class=linkLabel_WmDU>overview</span></a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Why suspend over IO</h1></header>
<p>Other functional ecosystems, Scala and Haskell among others,
use a <a class="" href=/learn/quickstart/from-fp/#computation-blocks>monadic model for side effects</a>. The key component of this model
is a wrapper called <code>IO</code>. Arrow has adopted a different model,
based on <code>suspend</code> and top-level extension functions over
<code>suspend () -> A</code>. This section explains the rationale behind this choice.</p>
<p>The reason for using <code>IO</code> is because you care about writing side-effecting code in a safe and referential transparent manner.
Additionally, <code>IO</code> offers powerful concurrent operators and cancellation in addition to offering a referential transparent runtime.
These properties are what makes using <code>IO</code> powerful, and <code>suspend</code> offers the exact same properties but natively in the language with support from the compiler.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11M9 11.5h2v4H9v2h6v-2h-2v-6H9zM13 8V6h-2v2z" clip-rule=evenodd /></svg></span>Arrow and Kotlin</div><div class=admonitionContent_BuS1><p>One of the main goals of Arrow is to provide APIs which feel idiomatic to
Kotlin developers. This section should be read in that light; what is a good
choice in Kotlin may not have the right trade-offs in other ecosystems.</div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=ergonomics>Ergonomics<a href=#ergonomics class=hash-link aria-label="Direct link to Ergonomics" title="Direct link to Ergonomics" translate=no>​</a></h2>
<p><code>IO</code> requires a wrapper in the return type: <code>fun number(): IO&lt;Int></code>, and thus we always have to work with the <code>IO</code> type to access the value we care about within.
A typical pattern for this is to use <code>flatMap</code>, so let's say we want to calculate 3 numbers and return them as a <code>Triple</code>.
To make the example concrete we use names inspired by <a href=https://typelevel.org/cats-effect/docs/getting-started target=_blank rel="noopener noreferrer" class="">Cats Effect</a>.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>pure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Triple</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>flatMap</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>flatMap</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">      </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>map</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">        </span><span class="token function" style=color:#EDB368>Triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>So simply to call a function 3 times, and combine the result into a <code>Triple</code> we had to use <code>flatMap</code> twice and <code>map</code>.
What that means under the hood we'll discuss in the performance section but in terms of ergonomics this is not ideal.
Especially not if we will compare it to the following <code>suspend</code> code.
We notice that we can forget about <code>flatMap</code> and <code>map</code>, and construct the <code>Triple</code> and call <code>number()</code> three times directly in the constructor.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Int </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style=color:#cfcd9a>1</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Triple</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token function" style=color:#EDB368>Triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M4.25 9a7.75 7.75 0 1 1 15.5 0v4.823l2.464 4.927H1.787l2.463-4.927zM10 23h4v-2h-4z" clip-rule=evenodd /></svg></span>Conclusion</div><div class=admonitionContent_BuS1><p>The ergonomics of <code>suspend</code> are clearly better here, and this is a very important point in Kotlin since the language aims for high ergonomics and developer friendly constructs.</div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=safety--purity--referential-transparency>Safety / Purity / Referential transparency<a href=#safety--purity--referential-transparency class=hash-link aria-label="Direct link to Safety / Purity / Referential transparency" title="Direct link to Safety / Purity / Referential transparency" translate=no>​</a></h2>
<blockquote>
<p>What guarantees does <code>IO</code> bring, and does <code>suspend</code> offer the same guarantees?</p>
</blockquote>
<p>At a conceptual level, <code>IO&lt;A></code> always results in a successful value, or
finishes with an exception. This can be clearly seen in Cats Effect,
where <a href="https://typelevel.org/cats-effect/api/3.x/cats/effect/IO.html#unsafeRunAsync(cb:Either%5BThrowable,A%5D=%3EUnit)(implicitruntime:cats.effect.unsafe.IORuntime):Unit" target=_blank rel="noopener noreferrer" class=""><code>unsafeRunAsync</code></a>
results in <code>Either&lt;Throwable, A></code>.
This is done so that any exceptions that occur within the <code>IO</code> API can be safely returned to the user, and it can be recovered from at any point in the code.
Important here is that a <code>Throwable</code> that occurs in an async thread is safely captured in the <code>IO</code> as well and can be recovered from at any point.</p>
<p><code>suspend</code> always results in <a href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-result/ target=_blank rel="noopener noreferrer" class=""><code>Result&lt;A></code></a>
which is equivalent to <code>Either&lt;Throwable, A></code>, and it can be used to offer the same safety guarantees as <code>IO</code>.
So the <code>suspend</code> API can also always return any exception safely to the user, and it can be recovered from at any point in the code.
In contrast to <code>IO</code>, we can only find <a href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines/start-coroutine.html target=_blank rel="noopener noreferrer" class=""><code>startCoroutine</code></a>
in the standard library, which has the same behavior as <code>unsafeRunAsync</code>.
Instead of <code>f: (Either&lt;Throwable, A>) -> Unit</code> you provide <code>f: (Result&lt;A>) -> Unit</code> to run the <code>suspend () -> A</code> program.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M4.25 9a7.75 7.75 0 1 1 15.5 0v4.823l2.464 4.927H1.787l2.463-4.927zM10 23h4v-2h-4z" clip-rule=evenodd /></svg></span>Conclusion</div><div class=admonitionContent_BuS1><p><code>suspend () -> A</code> offers us the same exact guarantees as <code>IO&lt;A></code>.</div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=effect-mixing>Effect mixing<a href=#effect-mixing class=hash-link aria-label="Direct link to Effect mixing" title="Direct link to Effect mixing" translate=no>​</a></h2>
<p>In this section we compare the ability to mix two effects, one of them being
the ability to perform side-effectful operations. In particular, we compare
<em>monad transformers</em> to <code>suspend</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=domain-errors>Domain errors<a href=#domain-errors class=hash-link aria-label="Direct link to Domain errors" title="Direct link to Domain errors" translate=no>​</a></h3>
<p>When writing code in functional style we often want to express our domain errors as clearly as possible, a popular pattern is to return <code>Either&lt;DomainError, SuccessValue></code>.
Let's assume the following domain, and compare two snippets: one using <code>IO&lt;Either&lt;E, A>></code>, and another <code>suspend () -> Either&lt;E, A></code>.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>import</span><span class="token plain"> arrow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Either</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>import</span><span class="token plain"> arrow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Either</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Left</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>import</span><span class="token plain"> arrow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Either</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Right</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token comment" style=color:#6b738a>/* inline */</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>class</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Long</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>object</span><span class="token plain"> PersistenceError</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>data</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>class</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>User</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> email</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>data</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>class</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>ProcessedUser</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> email</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>fetchUser</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> User</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token function" style=color:#EDB368>Right</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style=color:#EDB368>User</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal singleline string" style=color:#5B88F8>"simon@arrow-kt.io"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string-literal singleline string" style=color:#5B88F8>"Simon"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> User</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">email</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style=color:#EDB368>Regex</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal singleline string" style=color:#5B88F8>"^(.+)@(.+)$"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>Right</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style=color:#EDB368>ProcessedUser</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style=color:#EDB368>Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>else</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>Left</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockTitle_OeMC>Using IO&lt;Either&lt;E, A>></div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>import</span><span class="token plain"> arrow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">fx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>ioProgram</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"> IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>fx</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">   </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>effect</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>fetchUser</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">   </span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>fold</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> error </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">     IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>just</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Either</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>Left</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">     IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>effect</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token comment" style=color:#6b738a>// Or unwrapped in `suspend`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>suspendedIOProgram</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"> </span><span class="token function" style=color:#EDB368>ioProgram</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>suspended</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockTitle_OeMC>Using suspend () -> Either&lt;E, A></div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>import</span><span class="token plain"> arrow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">raise</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">either</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>suspendProgram</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  either </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>fetchUser</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>bind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token keyword" style=color:#82a2f3>val</span><span class="token plain"> processed </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>bind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    processed</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>The two above examples demonstrate how much simpler <code>suspend</code> is over its <code>IO</code> counterpart and how the <code>either</code> computation block allows us to bind values of <code>Either</code> to extract their right side all the while being inside <code>suspend</code>. Arrow allows intermixing effects in suspension. What otherwise would have required the <code>EitherT</code> transformer over <code>IO</code> now can just be expressed by wrapping in <code>either</code> instead.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=dependency-injection>Dependency injection<a href=#dependency-injection class=hash-link aria-label="Direct link to Dependency injection" title="Direct link to Dependency injection" translate=no>​</a></h3>
<p>We can use extension functions to do functional dependency injection with similar semantics as <code>Reader</code> or <code>Kleisli</code>.
They allow us to elegantly define syntax for a certain type.</p>
<p>Let's reuse our previous domain of<code>User</code>, <code>ProcessedUser</code>, but let's introduce <code>Repo</code> and <code>Persistence</code> layers to mimic something what could have been a small app with a couple of layers.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>interface</span><span class="token plain"> Repo </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>fetchUsers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> List</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">User</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>interface</span><span class="token plain"> Persistence </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> User</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> List</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">User</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> List</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    either </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> map </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> it</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>bind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>Given the above defined layers we can easily compose them by creating a product which implements the dependencies by delegation.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>class</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>DataModule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  persistence</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Persistence</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  repo</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Repo</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Persistence </span><span class="token keyword" style=color:#82a2f3>by</span><span class="token plain"> persistence</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Repo </span><span class="token keyword" style=color:#82a2f3>by</span><span class="token plain"> repo</span><br/></span></code></pre></div></div>
<p>We can also define top-level functions based on constraints on the receiver.
Here we define <code>getProcessedUsers</code> which can only be called where <code>R</code> is both <code>Repo</code> and <code>Persistence</code>.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token comment" style=color:#6b738a>/**</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token comment" style=color:#6b738a> * Generic top-level function based on syntax enabled by [Persistence] & [Repo] constraint</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token comment" style=color:#6b738a> */</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>suspend</span><span class="token plain"> </span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">R</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>getProcessedUsers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Either</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">PersistenceError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> List</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ProcessedUser</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">        </span><span class="token keyword" style=color:#82a2f3>where</span><span class="token plain"> R </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Repo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">              R </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Persistence </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>fetchUsers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11M9 11.5h2v4H9v2h6v-2h-2v-6H9zM13 8V6h-2v2z" clip-rule=evenodd /></svg></span>Context receivers</div><div class=admonitionContent_BuS1><p><a class="" href=/learn/design/receivers-flatmap/>Context receivers</a> offer a nicer approach to composition of layers.</div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=performance>Performance<a href=#performance class=hash-link aria-label="Direct link to Performance" title="Direct link to Performance" translate=no>​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd d="M4.25 9a7.75 7.75 0 1 1 15.5 0v4.823l2.464 4.927H1.787l2.463-4.927zM10 23h4v-2h-4z" clip-rule=evenodd /></svg></span>In short</div><div class=admonitionContent_BuS1><p><code>suspend</code> is extremely fast in comparison to <code>IO&lt;A></code>, since <code>IO&lt;A></code> is built at runtime and <code>suspend</code> is built by the compiler.</div></div>
<p>Working with an actual data type such as <code>IO&lt;A></code> implies that each composition of our program has some allocation cost.
This happens because <code>IO</code> requires different data classes to move computation from the stack to the heap in order to compose them and preserve properties such as lazy evaluation semantics. In contrast, when using <code>suspend</code>, the Kotlin compiler is aware of function composition on each suspension point and can desugar and specializes the program into more efficient target code. The code generated by the Kotlin compiler is better in terms of allocations and throughput when compared to other implementations of <code>IO</code> in the JVM.</p>
<p>Let's consider our previous example for ergonomics:</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>import</span><span class="token plain"> arrow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">fx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IO</span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>pure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Triple</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>flatMap</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>flatMap</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">      </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>map</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">        </span><span class="token function" style=color:#EDB368>Triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>If we translate this piece of code to the <code>data class</code> used, for example, in <a href=https://github.com/typelevel/cats-effect/blob/series/3.x/core/shared/src/main/scala/cats/effect/IO.scala target=_blank rel="noopener noreferrer" class="">Cats Effect</a>,
we need no less than 6 <code>IO</code> values.</p>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#D4D4D4;--prism-background-color:#222E51><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style=color:#D4D4D4;background-color:#222E51><code class=codeBlockLines_e6Vv><span class=token-line style=color:#D4D4D4><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>Just</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain"></span><span class="token keyword" style=color:#82a2f3>fun</span><span class="token plain"> </span><span class="token function" style=color:#EDB368>triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> IO</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Triple</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Int</span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token operator" style="color:rgb(212, 212, 212)">></span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>FlatMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>Pure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>FlatMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>Pure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">      IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>Map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">IO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style=color:#EDB368>Pure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style=color:#cfcd9a>1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(212, 212, 212)">-></span><span class="token plain"> </span><span class="token function" style=color:#EDB368>Triple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#D4D4D4><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br/></span></code></pre></div></div>
<p>This is necessary so that when <code>unsafeRun</code> is invoked the <code>IO</code> program can find the branch representing the kind of operation of <code>IO</code> that needs to be interpreted. In the example above it's <code>IO.FlatMap</code>, <code>IO.Map</code> or <code>IO.Pure</code></p>
<p>In contrast, <code>suspend</code> can simply be wired by the Kotlin compiler eliminating the need for additional <code>sealed class</code> declarations and allocations keeping computations in the stack instead of maintaining value level in memory representations of our program.
The Kotlin compiler rewrites the suspend program to a super fast runtime which uses a switch table and mutable state machine to run the <code>suspend</code> program.
Furthermore, the Kotlin compiler applies other optimizations focused on the speed of <code>suspend</code> and memory usage of suspension, making it suitable for hot spots and places where otherwise allocations-based data types are not an option.</div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/learn/design/receivers-flatmap/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Receivers vs. flatMap</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/learn/projects/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Example projects</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#ergonomics class="table-of-contents__link toc-highlight">Ergonomics</a><li><a href=#safety--purity--referential-transparency class="table-of-contents__link toc-highlight">Safety / Purity / Referential transparency</a><li><a href=#effect-mixing class="table-of-contents__link toc-highlight">Effect mixing</a><ul><li><a href=#domain-errors class="table-of-contents__link toc-highlight">Domain errors</a><li><a href=#dependency-injection class="table-of-contents__link toc-highlight">Dependency injection</a></ul><li><a href=#performance class="table-of-contents__link toc-highlight">Performance</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid container_y1z5"><div><div class="margin-bottom--sm logo_cbK_"><a href=https://arrow-kt.io rel="noopener noreferrer" class=footerLogoLink_BH7S><img src=/img/arrow-brand.svg alt="Arrow Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width=128 height=42 /><img src=/img/arrow-brand-dark.svg alt="Arrow Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width=128 height=42 /></a></div><small><div class=footer__copyright>Arrow is developed and maintained by the community</div></small></div><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a href=https://apidocs.arrow-kt.io target=_blank rel="noopener noreferrer" class=footer__link-item>API Docs<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a class=footer__link-item href=/community/blog/>Blog</a><li class=footer__item><a class=footer__link-item href=/learn/projects/>Example projects</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Learn</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/learn/quickstart/>Quickstart</a><li class=footer__item><a class=footer__link-item href=/learn/typed-errors/>Typed errors</a><li class=footer__item><a class=footer__link-item href=/learn/coroutines/>Coroutines</a><li class=footer__item><a class=footer__link-item href=/learn/resilience/>Resilience</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>...</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/learn/immutable-data/>Immutable data</a><li class=footer__item><a class=footer__link-item href=/learn/collections-functions/>Collections and functions</a><li class=footer__item><a class=footer__link-item href=/learn/design/>Design</a><li class=footer__item><a class=footer__link-item href=/learn/integrations/>Integrations</a></ul></div></div><ul class="clean-list container_dM9r"><li><a href=https://twitter.com/arrow_kt target=_blank rel="noopener noreferrer"><img src=/img/icon-social-twitter.svg alt=Twitter title=Twitter height=24px width=24px /></a><li><a href=https://slack-chats.kotlinlang.org/c/arrow target=_blank rel="noopener noreferrer"><img src=/img/icon-social-slack.svg alt=Slack title=Slack height=24px width=24px /></a><li><a href=https://github.com/arrow-kt target=_blank rel="noopener noreferrer"><img src=/img/icon-social-github.svg alt=GitHub title=GitHub height=24px width=24px /></a><li><a href=https://stackoverflow.com/questions/tagged/arrow-kt target=_blank rel="noopener noreferrer"><img src=/img/icon-social-stackoverflow.svg alt="Stack Overflow" title="Stack Overflow" height=24px width=24px /></a></li><div class=starsContainer_WEfU><div>Loading...</div></div></ul></div></footer></div></body>